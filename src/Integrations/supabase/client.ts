// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

// Support both Vite (import.meta.env) and Next.js (process.env)
// Check if we're in a browser environment first
const isBrowser = typeof window !== 'undefined';
const hasProcessEnv = typeof process !== 'undefined' && process.env;
const hasImportMeta = typeof import.meta !== 'undefined' && import.meta.env;

// Try Next.js environment variables first, then Vite
const SUPABASE_URL = 
  (hasProcessEnv && (process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.VITE_SUPABASE_URL)) ||
  (hasImportMeta && import.meta.env?.VITE_SUPABASE_URL) ||
  undefined;

const SUPABASE_KEY = 
  (hasProcessEnv && (
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || 
    process.env.VITE_SUPABASE_ANON_KEY || 
    process.env.VITE_SUPABASE_PUBLISHABLE_KEY
  )) ||
  (hasImportMeta && (
    import.meta.env?.VITE_SUPABASE_ANON_KEY || 
    import.meta.env?.VITE_SUPABASE_PUBLISHABLE_KEY
  )) ||
  undefined;

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

// Check if Supabase is configured (nur in Development warnen)
const isDev = 
  (hasProcessEnv && process.env.NODE_ENV === 'development') ||
  (hasImportMeta && import.meta.env?.DEV) ||
  false;

if (isDev && (!SUPABASE_URL || !SUPABASE_KEY)) {
  console.error(
    '‚ö†Ô∏è Supabase ist nicht konfiguriert. Bitte setze die Umgebungsvariablen:\n' +
    (hasProcessEnv 
      ? 'NEXT_PUBLIC_SUPABASE_URL und NEXT_PUBLIC_SUPABASE_ANON_KEY in einer .env.local Datei.\n'
      : 'VITE_SUPABASE_URL und VITE_SUPABASE_ANON_KEY (oder VITE_SUPABASE_PUBLISHABLE_KEY) in einer .env Datei.\n') +
    '(Diese Warnung wird nur in Development angezeigt)'
  );
}

// Debug: Zeige Konfiguration in Development
if (isDev) {
  console.log('üîç Supabase Config:', {
    url: SUPABASE_URL ? `${SUPABASE_URL.substring(0, 30)}...` : 'NICHT GESETZT',
    hasKey: !!SUPABASE_KEY,
    keyLength: SUPABASE_KEY?.length || 0,
    environment: hasProcessEnv ? 'Next.js' : 'Vite',
  });
}

// Create client with fallback values to prevent runtime errors
export const supabase = createClient<Database>(
  SUPABASE_URL || 'https://placeholder.supabase.co',
  SUPABASE_KEY || 'placeholder-key',
  {
    auth: {
      storage: localStorage,
      persistSession: true,
      autoRefreshToken: true,
    }
  }
);